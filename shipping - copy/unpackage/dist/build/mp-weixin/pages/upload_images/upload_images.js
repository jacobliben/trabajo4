(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/upload_images/upload_images"],{1273:function(e,t,a){"use strict";a.r(t);var n=a("1b35"),r=a.n(n);for(var o in n)"default"!==o&&function(e){a.d(t,e,(function(){return n[e]}))}(o);t["default"]=r.a},"1b35":function(e,t,a){"use strict";(function(e){Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var n,r,o,i,s,c,u,l=h(a("a34a")),d=a("2e4a");function h(e){return e&&e.__esModule?e:{default:e}}function p(e,t,a,n,r,o,i){try{var s=e[o](i),c=s.value}catch(u){return void a(u)}s.done?t(c):Promise.resolve(c).then(n,r)}function f(e){return function(){var t=this,a=arguments;return new Promise((function(n,r){var o=e.apply(t,a);function i(e){p(o,n,r,i,s,"next",e)}function s(e){p(o,n,r,i,s,"throw",e)}i(void 0)}))}}var g={data:function(){return{percent:0,loading:!1,disabled:!1,imgGoodsUrl:"/static/camera-scan.png",imgOrderUrl:"/static/camera-scan.png",tachar_scan:!1,tachar_goods:!1,tachar_order:!1,received_info:{},btn_title:"",canDispatch:null,short_distance:null,queryParams:{dispatchId:"",signWeight:"",leavePhoto:"",receiptPhoto:""},lng:null,lat:null,startCountrySubdivisionCode:"",endCountrySubdivisionCode:""}},mounted:function(){e.setNavigationBarTitle({title:"待".concat(this.btn_title,"派车单")}),this.canDispatch=e.getStorageSync("canDispatch")},onLoad:function(t){var a=this,n=this;this.received_info=e.getStorageSync("upload_item"),this.btn_title=t.btn_title,e.request({url:"https://restapi.amap.com/v3/geocode/geo?address=".concat(this.received_info.iscmShipper.shipperAddress,"&key=ae8b30ff7c227fb962010579230bf568"),success:function(t){r=t.data.geocodes[0].location.split(","),o=parseFloat(r[1]),i=parseFloat(r[0]),e.request({url:"https://restapi.amap.com/v3/geocode/geo?address=".concat(a.received_info.iscmConsignee.consigneeAddress,"&key=ae8b30ff7c227fb962010579230bf568"),success:function(t){s=t.data.geocodes[0].location.split(","),c=parseFloat(s[1]),u=parseFloat(s[0]),e.request({url:"https://restapi.amap.com/v3/direction/driving?origin=".concat(i,"%2C").concat(o,"&destination=").concat(u,"%2C").concat(c,"&key=ae8b30ff7c227fb962010579230bf568"),success:function(e){n.short_distance=parseFloat(e.data.route.paths[0].distance)/1e3,n.short_distance=n.short_distance.toFixed(2)}})}})}}),e.request({url:"https://restapi.amap.com/v3/geocode/geo?address=".concat(this.received_info.iscmShipper.shipperAddress,"&key=ae8b30ff7c227fb962010579230bf568")})},methods:{phoneCall:function(t){e.makePhoneCall({phoneNumber:t})},goWaybillDetails:function(){var t=this;e.navigateTo({url:"/pages/way_bill_details/way_bill_details?btn_title=".concat(t.btn_title)})},goMap:function(){e.navigateTo({url:"/pages/map/map"})},getSignWeight:function(e){this.queryParams.signWeight=e.target.value},getNote:function(e){this.queryParams.remark=e.target.value},takePhoto:function(t){var a=this;return f(l.default.mark((function r(){var o;return l.default.wrap((function(r){while(1)switch(r.prev=r.next){case 0:if(n=a,o=e.getStorageSync("token"),"people_vehicle_goods_photo"!=t.currentTarget.dataset.index){r.next=8;break}return r.next=5,a.$photo({success:function(t){return f(l.default.mark((function a(){var r;return l.default.wrap((function(a){while(1)switch(a.prev=a.next){case 0:return r=t.tempFilePaths,n.imgGoodsUrl=r[0],e.setStorageSync("temp_photo_path",r[0]),n.tachar_goods=!0,a.next=6,n.$upload({url:d.ossLocation.dispatch.rch,file_path:r[0],header:{Authorization:o}});case 6:a.sent;case 7:case"end":return a.stop()}}),a)})))()}});case 5:r.sent,r.next=25;break;case 8:if("ticket_photo"!=t.currentTarget.dataset.index){r.next=25;break}if("装货"!==a.btn_title){r.next=15;break}return r.next=12,a.$photo({success:function(t){return f(l.default.mark((function a(){var r;return l.default.wrap((function(a){while(1)switch(a.prev=a.next){case 0:return r=t.tempFilePaths,e.previewImage({urls:t.tempFilePaths}),n.imgOrderUrl=r[0],n.tachar_order=!0,a.next=6,n.$upload({url:d.ossLocation.dispatch.fhd,file_path:r[0],header:{Authorization:o}});case 6:a.sent;case 7:case"end":return a.stop()}}),a)})))()}});case 12:r.sent,r.next=25;break;case 15:if("发车"!==a.btn_title){r.next=21;break}return r.next=18,a.$photo({success:function(t){return f(l.default.mark((function a(){var r;return l.default.wrap((function(a){while(1)switch(a.prev=a.next){case 0:return r=t.tempFilePaths,e.previewImage({urls:t.tempFilePaths}),n.imgOrderUrl=r[0],n.tachar_order=!0,a.next=6,n.$upload({url:d.ossLocation.dispatch.leave,file_path:r[0],header:{Authorization:o}});case 6:a.sent;case 7:case"end":return a.stop()}}),a)})))()}});case 18:r.sent,r.next=25;break;case 21:if("签收"!==a.btn_title){r.next=25;break}return r.next=24,a.$photo({success:function(t){return f(l.default.mark((function a(){var r;return l.default.wrap((function(a){while(1)switch(a.prev=a.next){case 0:return r=t.tempFilePaths,e.previewImage({urls:t.tempFilePaths}),n.imgOrderUrl=r[0],n.tachar_order=!0,a.next=6,n.$upload({url:d.ossLocation.dispatch.receive,file_path:r[0],header:{Authorization:o}});case 6:a.sent;case 7:case"end":return a.stop()}}),a)})))()}});case 24:r.sent;case 25:case"end":return r.stop()}}),r)})))()},cancelGoods:function(){this.imgGoodsUrl="/static/camera-scan.png",setTimeout((function(){e.showToast({title:"删除货物照片成功，请重新选择",icon:"none"})}),500),this.tachar_goods=!1},cancelOrder:function(){this.imgOrderUrl="/static/camera-scan.png",setTimeout((function(){e.showToast({title:"删除运单照片成功，请重新选择",icon:"none"})}),500),this.tachar_order=!1},confirm:function(){var t=this;return f(l.default.mark((function a(){var n,r,o,i,s;return l.default.wrap((function(a){while(1)switch(a.prev=a.next){case 0:if(n=e.getStorageSync("token"),"装货"!==t.btn_title){a.next=20;break}if(t.queryParams.dispatchId=t.received_info.dispatchId,t.queryParams.groupPhoto=e.getStorageSync("people_vehicle_photo"),t.queryParams.packingListPhoto=e.getStorageSync("packing_list_photo"),r=t.queryParams,t.queryParams.groupPhoto){a.next=11;break}return e.showToast({title:"请上传人车货合照！",icon:"none"}),a.abrupt("return");case 11:if(t.queryParams.packingListPhoto){a.next=14;break}return e.showToast({title:"请上传发货单据！",icon:"none"}),a.abrupt("return");case 14:return a.next=16,t.$request({url:"/app/dispatch/loading",method:"PUT",data:r,header:{Authorization:n,"Content-Type":"application/x-www-form-urlencoded"}});case 16:o=a.sent,"操作成功"==o.data.msg?(e.showToast({title:"操作成功"}),e.reLaunch({url:"/pages/way_bill/way_bill"})):e.showToast({title:o.data.msg,duration:9e3}),a.next=54;break;case 20:if("发车"!==t.btn_title){a.next=34;break}if(t.queryParams.dispatchId=t.received_info.dispatchId,t.queryParams.leavePhoto=e.getStorageSync("dispatch_pending_photo"),r=t.queryParams,t.queryParams.leavePhoto){a.next=27;break}return e.showToast({title:"请上传发车单据！",icon:"none"}),a.abrupt("return");case 27:return a.next=29,t.$request({url:"/app/dispatch/departDispatch",method:"PUT",data:r,header:{Authorization:n}});case 29:i=a.sent,console.log(i,"发车"),"操作成功"==i.data.msg?(e.showToast({title:"操作成功"}),e.reLaunch({url:"/pages/way_bill/way_bill"})):e.showToast({title:i.data.msg}),a.next=54;break;case 34:if("签收"!==t.btn_title){a.next=53;break}if(t.queryParams.dispatchId=t.received_info.dispatchId,t.queryParams.receiptPhoto=e.getStorageSync("receipt_pending_photo"),r=t.queryParams,t.queryParams.receiptPhoto){a.next=43;break}return e.showToast({title:"请上传签收单据！",icon:"none"}),a.abrupt("return");case 43:if(t.queryParams.signWeight){a.next=46;break}return e.showToast({title:"请输入签收货物重量！",icon:"none"}),a.abrupt("return");case 46:return a.next=48,t.$request({url:"/app/dispatch/dispatchSign",method:"PUT",data:r,header:{Authorization:n}});case 48:s=a.sent,console.log(s,"签收"),"操作成功"==s.data.msg?(e.showToast({title:"操作成功"}),setTimeout((function(){e.reLaunch({url:"/pages/way_bill/way_bill"})}),1e3)):e.showToast({title:s.data.msg,icon:"none"}),a.next=54;break;case 53:e.navigateBack({});case 54:case"end":return a.stop()}}),a)})))()}}};t.default=g}).call(this,a("543d")["default"])},2461:function(e,t,a){"use strict";a.r(t);var n=a("6f8a"),r=a("1273");for(var o in r)"default"!==o&&function(e){a.d(t,e,(function(){return r[e]}))}(o);a("6717");var i,s=a("f0c5"),c=Object(s["a"])(r["default"],n["b"],n["c"],!1,null,"3b732bb7",null,!1,n["a"],i);t["default"]=c.exports},"3c7d":function(e,t,a){"use strict";(function(e){a("c5c7");n(a("66fd"));var t=n(a("2461"));function n(e){return e&&e.__esModule?e:{default:e}}e(t.default)}).call(this,a("543d")["createPage"])},"5a14":function(e,t,a){},6717:function(e,t,a){"use strict";var n=a("5a14"),r=a.n(n);r.a},"6f8a":function(e,t,a){"use strict";var n;a.d(t,"b",(function(){return r})),a.d(t,"c",(function(){return o})),a.d(t,"a",(function(){return n}));var r=function(){var e=this,t=e.$createElement;e._self._c},o=[]}},[["3c7d","common/runtime","common/vendor"]]]);